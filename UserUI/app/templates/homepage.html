{#<!--#}
{########################################################################}
{## File:     homepage.html#}
{## Authors:  Irfan Khan               999207665#}
{##           Larissa Ribeiro Madeira 1003209173#}
{## Data:     October 2017#}
{## Purpose:  User Homepage.#}
{########################################################################}
{#-->#}
{##}
{#<!DOCTYPE html>#}
{#<html lang="es">#}
{#  <head>#}
{#    <meta charset="utf-8">#}
{#    <meta http-equiv="X-UA-Compatible" content="IE=edge">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1">#}
{#    <title>Dashboard</title>#}
{##}
{#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">#}
{#    <link rel="stylesheet" href= "{{ url_for('static',filename='css/style.css') }}">#}
{#      <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>#}
{#    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>#}
{#    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>#}
{##}
{#  </head>#}
{#  <body>#}
{##}
{##}
{#  <div id="wrapper">#}
{##}
{#        <!-- Sidebar -->#}
{#        <div id="sidebar-wrapper" class="open">#}
{#            <ul class="sidebar-nav">#}
{#                <li class="sidebar-brand">#}
{#                    <a href="#">#}
{#                        Menu#}
{#                    </a>#}
{#                </li>#}
{#                <li>#}
{#                    <a href="#">Dashboard</a>#}
{#                </li>#}
{#                <li>#}
{#                    <a href="#upload_image">Upload Image</a>#}
{#                </li>#}
{#                <li>#}
{#                    <a href="#delete_user">Deactivate Account</a>#}
{#                </li>#}
{#                {% with messages = get_flashed_messages()%}#}
{#                  {% if messages %}#}
{#                    {% for message in messages %}#}
{#                      <div class="alert alert-warning">#}
{#                        <strong>Warning! </strong>{{ message}}#}
{#                      </div>#}
{#                    {% endfor %}#}
{#                  {% endif %}#}
{#                {% endwith %}#}
{#                <li>#}
{#                     <form class = "form-container" method="post" action="logout_submit">#}
{#                     <button type="submit" value='logout' class="button2">Log out</button>#}
{#                    </form>#}
{#                </li>#}
{#            </ul>#}
{#        </div>#}
{#        <!-- /#sidebar-wrapper -->#}
{##}
{#        <!-- Page Content -->#}
{#        <div id="page-content-wrapper">#}
{#            <div class="container-fluid">#}
                {#  TO DO:#}
{#                <div class="row">#}
{#                    <div class="col-lg-12">#}
{#                         <a class="pull-right btn btn-primary" href="#menu-toggle" id="menu-toggle">â˜°</a>#}
{#                     </div>#}
{#                </div>#}
{#                <h1>Image Gallery</h1>#}
{##}
{#                <div id="contain"></div>#}
{##}
{#      <div class="container">#}
{#          <div class="row">#}
{##}
{#           <div class="col-lg-3 col-md-4 col-xs-6 thumb" id="img">#}
{#              <div class="thumbnail">#}
{#                  <form action="transform_image" method="post" id="transform">#}
{#                     <input type="image" src="https://ece1779project2.s3.amazonaws.com/babygroot.jpg" name="image_name" alt="Lights" style="width:100%" value={{ image_name }}/>#}
{#                  </form>#}
{##}
{#             {% for image_name in image_names %}#}
{#                  {{ image_name}}#}
{#                  <div class="col-lg-3 col-md-4 col-xs-6 thumb" id="img">#}
{#              <div class="thumbnail">#}
{#                  <form action="transform_image" method="post" id="transform">#}
{#                     <input type="image" src="{{image_name}}" name="image_name" alt="Lights" style="width:100%" value={{ image_name }}/>#}
{#                  </form>#}
{##}
{#                  <div class="caption">#}
{#                  </div>#}
{#                </a>#}
{##}
{#              </div>#}
{#            </div>#}
{#            {% endfor %}#}
{##}
{#          </div>#}
{#        </div>#}
{#                <!-->#}
{#                <div class="target">#}
{#                     <div id="upload_image">#}
{#                         <form class="form-container" enctype=multipart/form-data method='post' action='upload_image_submit'>#}
{#                             <a href="/homepage">#}
{#                                 <button type="button" class="close" aria-label="Close">#}
{#                                     <span aria-hidden="true">&times;</span>#}
{#                                 </button>#}
{#                                </a>#}
{#                            <div>#}
{#                            <label>Image:  </label>#}
{#                            <input type='file' name='image'>#}
{#                            </div>#}
{#                             <br><br>#}
{#                            <input type='submit' value='Upload'class="btn btn-success" >#}
{#                            <p></p>#}
{#                        </form>#}
{#                    </div>#}
{#                       <div id="transform_image">#}
{#                         <form class="form-container" enctype=multipart/form-data method='post' action='upload_image_submit'>#}
{#                            <div>#}
{#                            <label>Image:  </label>#}
{#                            <input type='file' name='image'>#}
{#                            </div>#}
{#                            <input type='submit' value='upload'>#}
{#                            <p></p>#}
{#                        </form>#}
{#                    </div>#}
{##}
{##}
{#                    <div id="logout">#}
{#                        <form method='post' action='logout_submit'>#}
{#                            <input type='submit' value='logout'>#}
{#                             <p></p>#}
{#                         </form>#}
{#                    </div>#}
{#                    <div id="delete_user">#}
{#                         <form class = "form-container" method="post" action="delete_user_submit">#}
{#                                <a href="/homepage">#}
{#                                    <button type="button" class="close" aria-label="Close">#}
{#                                         <span aria-hidden="true">&times;</span>#}
{#                                     </button>#}
{#                                </a>#}
{#                             <div class="form-group">#}
{#                                <label for="userInputPassword">Password</label>#}
{#                                <input type="password" name='password' class="form-control" placeholder="Password">#}
{#                             </div>#}
{#                             <button type="submit" value='delete_myaccount' class="btn btn-danger">Deactivate Account</button>#}
{#                         </form>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{##}
{#        </div>#}
{#        <!-- /#page-content-wrapper -->#}
{##}
{#    </div>#}
{#    <!-- /#wrapper -->#}
{##}
{#   <!-- Menu Toggle Script -->#}
{#    <script>#}
{#    $("#menu-toggle").click(function(e) {#}
{#        e.preventDefault();#}
{#        $("#wrapper").toggleClass("toggled");#}
{#    }).click();#}
{#    </script>#}
{##}
{#  </body>#}
{#</html>#}
<html>
  <head>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.3.0.min.js"></script>
    <script>
    AWS.config.update({
      accessKeyId: 'AKIAJQSTWU6FGCSIJ2IAid',
      secretAccessKey: 'yE+/TYwUKezm7rYaXylgFe8JYpOLxNs3kR0PqucV',
      region: 'US East (N. Virginia)'
    });
    var S3 = new AWS.S3({params: {Bucket: 'testbucketlrm'}});
    var Dynamo = new AWS.DynamoDB.DocumentClient({region: 'US East (N. Virginia)'});
    </script>
  </head>

  <body>
    Image: <input type="file" id="file-chooser" />
    <br>
    Gallery: <input type="text" id="gallery-name" />
    <br>
    <button id="upload-button">Upload Image</button>
    <button id="list-images">List images in gallery </button>

    <ul id="image-list" />

    <script>
    // Fetch the gallery name from the gallery input
    function getGalleryName() {
      return document.getElementById('gallery-name').value;
    }
    // Grab a reference to the upload button
    let uploadButton = document.getElementById('upload-button');
    // Make the button respond to clicks
    uploadButton.addEventListener('click', function() {
      let fileChooser = document.getElementById('file-chooser');
      let file = fileChooser.files[0];
      // Check that the user has specified a file to upload
      if (!file) {
        alert("You must choose a file to upload!");
        return;
      }
      // Check the MIME type is an image
      if (file.type.indexOf("image") == -1) {
        alert("You may only upload images");
        return;
      }
      // Get the gallery name and check that it isn't empty
      let galleryName = getGalleryName();
      if (!galleryName) {
        alert("You need to enter a gallery name");
        return;
      }
      // Specify the S3 upload parameters
      let params = {
        Key: galleryName + '/' + file.name,
        ContentType: file.type,
        Body: file,
        ACL: 'public-read'
      };
      // Upload the file
      S3.upload(params, function(err, data) {
        if (err) {
          alert(err);
        } else {
          alert("Image uploaded successfully!");
        }
      });
    });
    // Get a reference to the button to list images
    let listImagesButton = document.getElementById('list-images');
    // Upon click, fetch the index from Dynamo and use that to
    // fetch images in the specified gallery
    listImagesButton.addEventListener('click', function() {
      let galleryName = getGalleryName();
      if (!galleryName) {
        alert("Must enter a gallery name to list the images!");
        return;
      }
      // Disable the list button so you can't perform multiple fetches at once
      listImagesButton.disabled = true;
      // Dispose of any images from previous fetches
      emptyImageList();
      // Fetch all images in the gallery, then re-enable the list button.
      listImagesInGallery(galleryName, function(err) {
        if (err) {
          alert("Dynamo error: " + err);
        }
        listImagesButton.disabled = false;
      });
    })
    // Fetch all images in the given gallery.
    // `startKey` represents the exclusive start key of the Dynamo query.
    // To start a new query, leave `startKey` undefined.
    // This function recursively calls itself until there are no more query pages,
    // and then runs the callback.
    function listImagesInGallery(galleryName, cb, startKey) {
      let params = {
        TableName: 'your-index-name',
        ProjectionExpression: 'file_path',
        KeyConditionExpression: 'gallery = :galleryname',
        ExpressionAttributeValues: {
          ":galleryname": galleryName
        },
        ExclusiveStartKey: startKey,
      }
      Dynamo.query(params, function (err, data) {
        if (err) {
          return cb(err);
        }
        for (item of data.Items) {
          appendImageToList(item.file_path);
        }
        if (data.LastEvaluatedKey) { // need to fetch more data
          listImagesInGallery(galleryName, cb, data.LastEvaluatedKey);
        } else {
          return cb(null);
        }
      })
    }
    // Add an image to the end of the image list
    function appendImageToList(imagePath) {
      let ul = document.getElementById('image-list');
      let li = document.createElement('li');
      let img = document.createElement('img');
      img.src = 'https://s3.amazonaws.com/testbucketlrm/' + imagePath
      img.style.maxWidth = "200px";
      li.appendChild(img);
      ul.appendChild(li);
    }
    // Remove all images from the image list
    function emptyImageList() {
      document.getElementById('image-list').innerHTML = '';
    }
    </script>
  </body>
</html>